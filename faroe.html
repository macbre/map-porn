<!DOCTYPE html> 
<html>
	<title>Faroe Islands - map</title>

	<!-- fonts -->
	<link href="https://fonts.googleapis.com/css2?family=Gudea:wght@400;700&family=Josefin+Sans:wght@100;600&family=Lora:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">

	<!-- leaflet -->
	<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>
	<script src="static/leaflet-providers.js"></script>
	<script src="static/L.Graticule.js"></script>

	<!-- our assets -->
	<link rel="stylesheet" href="static/map.css">
	<script src="static/map.js"></script>
	<script src="static/faroe.js"></script>

	<link rel="license" href="https://creativecommons.org/licenses/by/4.0/" />

	<body lang="en">
		<div id="wrapper">
			<section id="overlay">
				<h1 lang="en">Faroe Islands</h1>
				<h1 lang="pl">Wyspy Owcze</h1>

				<h2 lang="en">place-names</h2>
				<h2 lang="pl">toponimy</h2>

				<legend style="width: 41%">
					<!-- <img src="https://3.bp.blogspot.com/-d6oBGCensQ8/U2ADslYwc4I/AAAAAAAAIXM/SSR4NbDTxP8/s1600/IMG_0500.jpg"> -->
					<p lang="en">
						Town and city names on Faroe Islands often reflect their location.
						<br><br>
						Numerous settlements lie by the <strong>bays</strong> (these have the <em>-v√≠k</em> suffix).
						Others are located at a bit longer and narrower kind of a bay - called <strong>fjord</strong> (<em>-fj√∏r√∞ur</em>).
						<br>
						Smaller bays are called <strong>v√°g</strong> in Faroese (which is used in the <em>-v√°gur</em> form in place-names).
						<br>
						<strong>Valleys</strong> (<em>-dalur</em>) have their representatives as well as <strong>headlands</strong> (<em>-nes</em>).
						<br><br>
					</p>
					<p lang="pl" _style="font-size: 1.6rem">
						Nazwy farerskich osad i miasteczek najczƒô≈õciej nawiƒÖzujƒÖ od ich po≈Ço≈ºenia.
						<br><br>
						Poszarpana linia brzegowa Wysp Owczych obfituje w liczne <strong>zatoki</strong> - po≈Ço≈ºone przy nich miejscowo≈õci wyr√≥≈ºnia ko≈Ñc√≥wka <em>-v√≠k</em>. Nazwy osad po≈Ço≈ºonych nad d≈Çu≈ºszymi i wƒô≈ºszymi zatokami zako≈Ñczone sƒÖ cz≈Çonem <em>-fj√∏r√∞ur</em>. Jƒôzyk farerski wyr√≥≈ºnia tak≈ºe mniejszy rodzaj zatoki - <strong>v√°g</strong>, kt√≥ra w toponimach wystƒôpuje w formie <em>-v√°gur</em>.
						<br>
						Swoich nazewniczych przedstawicieli majƒÖ r√≥wnie≈º farerskie doliny (<em>-dalur</em>)<br>i p√≥≈Çwyspy (<em>-nes</em>).
					</p>
					<ul>
						<!--<li><span class="marker black"></span><span lang="en">major towns</span><span lang="pl">g≈Ç√≥wne miasta</span></li>-->
					</ul>
				</legend>

				<label id="atlantic-ocean">
					<span lang="en">Atlantic Ocean</span>
					<span lang="pl">Ocean Atlantycki</span>
				</label>

				<section id="small-map">

				</section>

				<!-- <label style="
				position: absolute;
				font-size: 12em;
				filter: grayscale(1);
				top: 1121px;
				left: 871px;
				transform: rotate(28deg);
				opacity: .8;
				">
					üêë
				</label> -->
			</section>

			<img id="logo" src="static/logo.png" />

			<div id="map"></div>
			<section class="info">
				<div>
					<p>
						<strong lang="en">Research</strong><strong lang="pl">Opracowanie</strong>: Maciej Brencz @ farerskiekadry.pl
					</p>
					<p>
						<strong lang="en">Data</strong><strong lang="pl">Dane</strong>: <!-- Landsverk, -->Umhv√∏rvisstovan<!--, Strandfaraskip Landsins, OpenStreetMaps-->.
					</p>
				</div>

				<div>
					<p>
						<strong lang="en">Maps rendered with</strong><strong lang="pl">Mapy</strong> Leaflet, Stamen.
					</p>
					<p lang="en">
						<strong>Licensed under</strong> Creative Commons Attribution.
					</p>
					<p lang="pl">
						<strong>Licencja</strong> Creative Commons Uznanie autorstwa.
					</p>
				</div>
			</section>
		</section>

		<script>
		(async() => {			
			const colors = [
				'blue', 'yellow', 'green', 'red', 'dark-green',
			];

			await initMap(async (map) => {
				const geojson = await fetchGeoJSON('/geojson/us-bygdir-us_bygdir-0-bygdir.json');

				map.createPane('features');
				map.getPane('features').style.zIndex = 700;

				const suffixes = {
					'v√≠k': 0,
					'nes': 0,
					'dalur': 0,
					'fj√∏r√∞ur': 0,
					'v√°gur': 0,
				};

				let otherTowns = 0;

				L.geoJSON(geojson, {
					pane: 'features',
					filter: (feature, _layer) => {
						let name = '' + feature.properties.stad;
						const geo = feature.geometry.coordinates;

						let marked = false;

						// some filtering
						if (['Giljanes'].includes(name)) {
							return false;
						}

						// Sy√∞radalur, Kalsoy
						if (name.includes(',')) {
							if (!name.startsWith('Nes,')) {
								name = name.split(',')[0];
							}
							else {
								// Nes, Hvalba
								name = name.split(',')[1].trimLeft();
							}
						}

						Object.keys(suffixes).forEach( (suffix, idx) => {
							if (name.toLowerCase().endsWith(suffix)) {
								const color = colors[idx];
								suffixes[suffix]++;

								console.log({name, geo, suffix, color, stad: feature.properties.stad});

								L.marker([geo[1], geo[0]], {icon: getIcon(color), pane: `markers-${color}`}).addTo(map);

								marked = true;
							}
						});

						// mark "other towns"
						if (!marked) {
							L.tooltip({pane: 'labels', direction: 'left'})
								.setLatLng( [geo[1], geo[0]] )
								.addTo(map);

							otherTowns++;
						}

						// L.marker([geo[1], geo[0]], {icon: getIcon(color), pane: `markers-${color}`}).addTo(map);

						// count++;
						return false; // do not add the default markers on the map
					}
				}).addTo(map);

				console.log({suffixes});

				Object.keys(suffixes).forEach( (suffix, idx) => {
					addLabel(colors[idx], `-${suffix} suffix`, `ko≈Ñc√≥wka -${suffix}`, suffixes[suffix]);
				});

				addLabel('black', 'other settlements', 'pozosta≈Çe miasta', otherTowns);

				// L.tooltip({pane: 'labels', direction: 'right'})
				// 	.setLatLng( L.latLng(61.833611111111, -6.8169444444444) )
				// 	.setContent('Sandur')
				// 	.addTo(map);

				// L.tooltip({pane: 'labels', direction: 'left'})
				// 	.setLatLng( L.latLng(61.526388888889, -6.8769444444444) )
				// 	.setContent('F√°mjin')
				// 	.addTo(map);

				// L.tooltip({pane: 'labels', direction: 'right'})
				// 	.setLatLng( L.latLng(62.3601, -6.5333) )
				// 	.setContent('Vi√∞arei√∞i')
				// 	.addTo(map);

				// 	L.tooltip({pane: 'labels', direction: 'right'})
				// 	.setLatLng( L.latLng(61.7822, -6.6756) )
				// 	.setContent('Dalur')
				// 	.addTo(map);


				/**
				// green / blue / yellow
				await addGeoJSONLayer(map, '/geojson/us-rulluportur-rulluportur_alment-0-cattle_grid.json', 'dark-green', 'cattle grids', 'owcze bramki', (feature) => {
					const city = feature.properties.city;
					// console.log(city);

					if (typeof gridsPerCity[city] === 'undefined') gridsPerCity[city] = 0;
					gridsPerCity[city]++;
				});
				**/
			});

			// console.log(gridsPerCity);
		})();
		</script>

		<style>
			/**
			 * @see https://developer.mozilla.org/en-US/docs/Web/CSS/gradient/conic-gradient
			 */
			 /**
			.marker.red {
				background: conic-gradient(transparent 0, transparent 180deg, #d73027 180deg);
			}
			.marker.green { 
				background: conic-gradient(#1a9850 0, #1a9850 180deg, transparent 180deg);
			}
			/**/
		</style>

	</body>
</html>